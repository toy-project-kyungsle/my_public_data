> **"정답" 대신 "비용 모델"로 설계 결정을 내리고, 서버/엣지/클라의 로직 배치를 비용(정합성/네트워크/캐시/렌더) 기준으로 판단하는 능력**

[SWR & 설계 트레이드오프 판단 액션 플랜](my_public_data/roadmap/docs/etc/swr_설계_트레이드오프_판단_액션_플랜.md)

아래는 **'판단 → 실행 아이템 → 측정'**까지 이어지는 형태야. (웹+RN 공통)

---

## 0) 트레이드오프 판단의 기본 프레임: "정답"이 아니라 "비용모델"

각 기능을 볼 때, 아래 4개 비용 중 **제일 비싼 놈**을 먼저 잡아.

1. **정합성 비용(돈 새는 버그)**: 가격/쿠폰/재고/결제 상태가 틀리면 끝
2. **네트워크 비용**: 왕복 지연 + 요청 수 + 실패/재시도
3. **캐시 비용**: 신선도(정확한가) vs 속도(빨라졌나) + 무효화 난이도
4. **렌더 비용**: (웹) LCP/INP/CLS, (RN) JS thread/FPS/리스트 렌더

### 액션

이 프레임으로 보면 "로직 실행 위치"는 이렇게 결정돼:

- **정합성이 최우선이면 서버(또는 BFF)**
- **지연이 최우선이면 캐시/엣지/프리패치**
- **상호작용이 최우선이면 클라(optimistic) + 서버로 확정**

✅ Done: 기능별로 "제일 비싼 비용"이 식별되고, 로직 실행 위치가 결정됨.

---

## 1) "로직 실행 위치" 결정 규칙 (서버 vs 엣지 vs 클라)

### 액션

**A. 서버/BFF로 보내야 하는 로직 (커머스 P0)**

- **가격/할인/쿠폰 적용 최종 계산**
- **재고/구매 가능 여부**
- **결제 상태 전이(중복결제 방지, 멱등키)**
  이건 "빠르게 보여주는 UI"는 클라에서 해도, **최종 판정은 서버가 권위**여야 함.

**B. 클라에서 해도 되는 로직 (속도/UX)**

- "표시용 정렬/필터/탭 상태"
- "추천/검색 결과의 스켈레톤 + 점진 로딩"
- "장바구니 수량 변경 UI(단, 서버 확정 실패 시 롤백)"

**C. 엣지/CDN로 보내면 이득 나는 로직 (트래픽/지연)**

- 지역 기반 컨텐츠(배너/기획전/카테고리)
- 변동 적은 데이터(브랜드/카테고리 메타, 정적 섹션)
- SSR/ISR(Next.js라면)로 **초기 HTML을 빠르게**
  Next.js는 캐싱/리밸리데이션을 프레임워크 레벨로 지원해서 "서버에서 fetch + 캐시" 조합이 쉬워. ([Next.js](https://nextjs.org/docs/app/getting-started/caching-and-revalidating?utm_source=chatgpt.com "Getting Started: Caching and Revalidating"))

✅ Done: API/화면별로 서버/엣지/클라 배치가 결정됨.

---

## 2) 캐싱 아이디어: "레이어 5단 캐시"로 백로그 만들기

캐시는 한 방에 끝내지 말고 **어디에 저장할지** 레이어로 쪼개면 액션 플랜이 바로 나와.

### 액션

**(1) HTTP 캐시(브라우저/중간 캐시) — 웹에서 가장 ROI 큼**

- `Cache-Control`, `ETag`, `max-age`, `stale-while-revalidate`로 "즉시 로드 + 백그라운드 갱신" 패턴 가능 ([developer.mozilla.org](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Cache-Control?utm_source=chatgpt.com "Cache-Control header - HTTP - MDN Web Docs"))
- 정적 리소스(이미지/폰트/JS chunk) 캐시 정책 점검
- **상품상세/검색 API 중 '변동 낮은 응답'**을 SWR 적용 후보로 분류

**(2) CDN 캐시(서버 앞단) — 트래픽/TTFB 절감**

- "배너/기획전/브랜드 메타/카테고리 트리"처럼 **대다수 유저에게 동일**한 응답을 CDN에 올림
- API를 "캐시 가능/불가"로 라벨링하고, 캐시 키(쿼리/헤더) 설계

**(3) 앱/웹 클라 데이터 캐시 (React Query/SWR 같은 것)**

- 캐시를 하면 **요청 수 감소 + 재방문 속도 상승**
- "검색 결과 30초, 상품상세 60초, 추천 10초" 같은 TTL 초안 만들기
- 장바구니/쿠폰/결제는 **캐시 금지(또는 아주 짧게)**

**(4) 이미지 캐시 (RN/웹 공통)**

- 이미지가 네트워크와 렌더를 동시에 잡아먹음.
- RN에서도 이미지 캐싱이 네트워크 요청을 줄인다는 실무 팁들이 반복됨 ([Sentry](https://blog.sentry.io/tips-for-optimizing-react-native-application-performance-part-1/?utm_source=chatgpt.com "10 Tips for Optimizing React Native Application Performance"))
  (다만 "어떤 라이브러리/옵션을 쓰느냐"는 코드베이스마다 다르니, 여기선 정책/측정 중심으로 접근하는 게 안전)

**(5) "사전계산 캐시" (서버에서 미리 만들어두기)**

- 추천/랭킹/베스트/기획전 상품 리스트처럼 "자주 조회, 가끔 변경"은 서버에서 **사전 계산 후 캐시**가 강력함.

✅ Done: 5단 캐시 레이어별로 적용 대상과 TTL이 정리됨.

---

## 3) 네트워크 아이디어: 요청 수/우선순위/실패를 설계로 줄이기

### 액션

**A. 요청 수 줄이기 (가장 확실한 성능)**

- **배칭/집계 API**: 홈 진입 시 섹션별 API 6개 → 1~2개로
- **중복 요청 제거**: 동일 endpoint 동시 호출 "in-flight dedupe"
- **prefetch**: 사용자가 "다음에 갈 확률이 높은 것"만
  예: 검색 결과 리스트에서 상위 1~3개 상품상세 프리패치

**B. 우선순위 설계**

- 결제/로그인/장바구니처럼 "막히면 이탈"은 최우선
- 추천/리뷰/유사상품은 후순위(지연 로드)

**C. 실패/재시도 설계(커머스는 여기서 돈 샘)**

- 타임아웃/재시도는 **멱등/중복결제 방지** 전제에서만
- "네트워크 실패 시 UX":
  - 쿠폰 적용 실패 → "적용 안 됨"으로 롤백 + 재시도 버튼
  - 결제 실패 → 상태를 서버에서 다시 조회(클라만 믿지 않기)

✅ Done: 요청 수/우선순위/실패 처리 정책이 정리됨.

---

## 4) 렌더 비용 아이디어: "초기진입 / 리스트 / 상호작용" 3개로 쪼개기

### 액션

**웹**

- 초기 진입: SSR/ISR/캐시로 TTFB+LCP 개선 (Next.js 캐시/리밸리데이션 활용) ([Next.js](https://nextjs.org/docs/app/getting-started/caching-and-revalidating?utm_source=chatgpt.com "Getting Started: Caching and Revalidating"))
- 리스트: 이미지/카드 컴포넌트가 무거움 → **가상화/지연 로드** 후보
- 상호작용(INP): 클릭 후 "상태 업데이트 + 네트워크 + 렌더"가 겹치는 지점 분해

**RN**

- RN 병목은 "JS thread/브릿지/불필요 렌더"가 자주 원인으로 언급됨(공식 퍼포먼스 가이드 참고) ([reactnative.dev](https://reactnative.dev/docs/performance?utm_source=chatgpt.com "Performance Overview"))
- 장바구니/검색 리스트: 렌더 횟수/셀 컴포넌트 무게를 측정해서 줄이기
- 네트워크 응답을 한 번에 state에 붓는 패턴(큰 re-render) 분리

✅ Done: 웹/RN별 렌더 최적화 포인트가 식별됨.

---

## 5) 커머스 유즈케이스별 "바로 뽑을 수 있는 액션 플랜 후보"

### 액션

**① 검색(검색 전환율)**

- 후보: **검색 결과 캐시(짧게) + 프리패치 + 스켈레톤**
- 가드레일: 가격/재고는 상세 진입 시 서버 확정
- 측정: 검색 결과 노출→상세→구매 전환, 검색 API 요청 수/지연

**② 상품상세(전환 직결)**

- 후보: **상세 데이터 SWR**, 이미지 최적화, "필수 정보 먼저 렌더"
- 가드레일: 쿠폰/할인은 서버 확정 결과를 기준으로 표시
- 측정: PDP 로딩시간, 상세→장바구니/구매 전환

**③ 장바구니(구매 전 단계)**

- 후보: optimistic UI(수량 변경 즉시 반영) + 서버 실패 시 롤백
- 가드레일: merge/재고/최종 금액은 서버에서 확정
- 측정: 장바구니 이탈률, 수량 변경 실패율

**④ 쿠폰(결제 이탈률에 직격)**

- 후보: 쿠폰 리스트는 캐시 가능(짧게), **적용/해제는 캐시 금지**
- 가드레일: "표시 할인금액 ≠ 결제금액" 불일치 로그/알림
- 측정: 쿠폰 적용 성공률, 결제 단계 이탈률 변화

**⑤ 추천(추천 CTR)**

- 후보: 추천은 "신선도 vs 속도" 트레이드오프의 대표
  - 홈 추천: 짧은 TTL + 백그라운드 갱신
  - PDP 유사상품: 캐시 길게 + 상품 품절/가격만 부분 갱신
- 측정: 추천 CTR, 추천 클릭 후 구매 전환

✅ Done: 유즈케이스별 캐시/네트워크/렌더 액션이 정리됨.

---

## 6) "액션 플랜"으로 옮길 수 있게: 이번 주 백로그 예시(바로 실행형)

### 액션

- (D1) API/화면을 **캐시 가능/불가 라벨링**(결제/쿠폰/장바구니/로그인은 기본 불가)
- (D2) 웹: HTTP 캐시 정책 점검표 작성 + SWR 후보 3개 선정 ([developer.mozilla.org](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Cache-Control?utm_source=chatgpt.com "Cache-Control header - HTTP - MDN Web Docs"))
- (D3) 검색 결과 상위 N개 **프리패치 실험**(A/B 아니어도 로그로 효과 측정)
- (D4) "in-flight dedupe(동일 요청 중복 제거)" 적용 지점 1개 찾기
- (D5) RN: 리스트 화면 1개 골라 **렌더 횟수/프레임 드랍** 원인 3개만 제거(작게)

✅ Done: 이번 주 실행 가능한 백로그 5개가 정의됨.
