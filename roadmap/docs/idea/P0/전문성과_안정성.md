> **안정성 : 결제/쿠폰/장바구니/로그인 같은 매출 플로우가 "절대 깨지지 않게" 설계·구현·검증·배포까지 묶어서 책임지는 능력**
> **전문성 : 불변식·타입 시스템·상태 분리·테스트 전략·레이어 격리를 활용해 "왜 안 깨지는지"를 설명·증명·재현할 수 있는 기술적 깊이** 
---

## 0) P0의 기준을 먼저 "불변식(절대 깨지면 안 되는 것)"으로 선언

### 액션

- 4대 플로우별로 **불변식 3개씩** 문장으로 고정하고, PR에서 항상 참조한다.

**예시 불변식**

- 결제: "주문은 한 번만 생성된다(멱등)", "결제 상태는 단방향 전이", "완료 후 장바구니/쿠폰 정리"
- 쿠폰: "중복 적용 불가", "최종 계산은 서버 권위", "표시금액≠결제금액이면 차단/경고"
- 장바구니: "동일 상품/옵션 병합 규칙 동일", "수량 0 이하 금지", "로그인 전/후 merge 결정적"
- 로그인: "동시 refresh 레이스 방지", "로그아웃 시 민감 상태 초기화", "세션 만료는 안전한 fallback"

✅ Done: 불변식이 PR 템플릿에 들어가고, 고위험 변경은 최소 1개 이상 테스트로 커버됨.

---

## 1) 타입(TypeScript)로 "불가능한 상태를 표현하지 못하게" 만들기

### 액션

- 핵심 도메인(결제/쿠폰/주문/장바구니)의 상태를 `string`이 아니라 **유니온 + 상태머신 형태**로 모델링
- "결제 금액/쿠폰 할인"은 **브랜디드 타입** 또는 `Money` 객체로 감싸서 단위/형 변환 실수 방지
- API 응답은 런타임 검증(간단히라도) + 타입 생성(가능하면)으로 "깨진 응답"을 빨리 발견

[[유니온 브랜디드 Value Object]]

✅ Done: 결제/쿠폰 상태가 `any/string`으로 흐르지 않고, 잘못된 전이가 컴파일 타임/테스트에서 걸림.

---

## 2) 상태 관리: "서버 상태 vs UI 상태" 경계를 명확히

### 액션

- **서버 상태(조회/캐시/동기화)**와 **UI 상태(탭, 모달, 입력)**를 분리
- 결제/쿠폰/장바구니는 optimistic을 쓰더라도 **롤백 경로**를 반드시 정의
- "중복 클릭/중복 요청"을 프론트 레벨에서 1차 차단(in-flight 단일화)

✅ Done: 결제/쿠폰 버튼 연타, 네트워크 재시도에서 중복 요청이 발생하지 않음(또는 멱등으로 안전).

---

## 3) 테스트 전략: "돈 새는 케이스"만 정확히 커버 (과하지 않게)

### 액션 (권장 순서)

1. **도메인 단위 테스트**: 가격/쿠폰 계산, 상태 전이, 병합 규칙
2. **통합 테스트**: "쿠폰 적용→장바구니→결제 시작" 같은 경로에서 API mocking
3. **E2E(핵심 2~3개만)**: 로그인→장바구니→결제완료 / 쿠폰 적용 실패→복구

**예시 테스트 케이스 (고위험)**

- 결제: 재시도/백버튼/앱 백그라운드 복귀 시 중복 결제 방지
- 쿠폰: 적용 후 금액 변경(배송비/옵션) 시 재계산 정합성
- 장바구니: 로그인 전/후 merge 충돌
- 로그인: refresh 토큰 동시 갱신 레이스

✅ Done: "절대로 일어나면 안 되는 3가지"가 자동 테스트로 막힘.

---

## 4) 에러 처리/UX: 실패는 반드시 "복구 가능한 상태"로 귀결

### 액션

- 네트워크/서버 오류를 "토스트"로 끝내지 말고, 플로우별 **복구 버튼/경로**를 만든다.
  - 결제 실패: 상태 재조회 → 재시도(멱등 전제) 또는 다른 수단 선택
  - 쿠폰 실패: 적용 해제/재시도 + 사유 안내(만료/조건미달)
  - 로그인 실패: 재로그인 유도 + 진행 중 상태 안전 초기화

✅ Done: 실패 후 사용자가 막히지 않고, KPI(결제 이탈률)가 덜 튄다.

---

## 5) 코드 구조: "고위험 코드는 격리"해서 리뷰/테스트 밀도를 올린다

### 액션

- 결제/쿠폰/로그인 관련 로직을 UI에서 분리해서:
  - `domain/` (순수 로직)
  - `services/` (API/IO)
  - `ui/` (표현)
    레이어를 나눔
- 위험 API/패턴(HTML 주입, WebView 브릿지 등)은 **한 곳에만** 모으고 나머지는 접근 금지

✅ Done: 위험 변경이 생기면 "바뀌는 파일/영향 범위"가 명확해짐.

---

## 6) 리뷰/릴리즈 안전장치: "고위험 변경"을 따로 다룬다

### 액션

- PR에 리스크 라벨(HIGH/MED/LOW) 강제
- HIGH(결제/쿠폰/로그인/장바구니) 변경은:
  - 불변식 3개 작성
  - 테스트 1개 이상 추가/수정
  - 롤백/플래그/완화 전략(간단히라도) 명시

✅ Done: "고위험 변경은 항상 더 두껍게 검증된다"가 팀 규칙이 됨.

---

## 7) P0의 "성과 증거"를 남기는 방식 (중요)

P0는 티가 안 나서 평가에서 손해 보기 쉬워. 그래서 **증거를 남겨야** 해.

### 액션

- 고위험 이슈(중복 결제/쿠폰 오류/장바구니 merge) 대응 후
  - 원인(상태/레이스/정합성)
  - 재발 방지(불변식/테스트/가드)
    를 1페이지로 남김(짧아도 됨)

✅ Done: "안 깨지게 만든 근거"가 쌓여서 전문성이 보인다.

---

## 바로 적용 가능한 "P0 백로그 아이디어" (선택해서 가져가)

- 결제/쿠폰/로그인/장바구니 각각 **불변식 3개** PR 템플릿에 추가
- 결제/쿠폰 "중복 클릭 방지 + in-flight 단일화" 공통 유틸 만들기
- 쿠폰 적용/해제 상태를 `union type`으로 재모델링하고 잘못된 전이 컴파일 에러로 막기
- 장바구니 merge 규칙을 순수 함수로 분리하고 테스트 5개 추가
- 로그인 refresh 레이스를 단일화(동시 refresh 방지)하고 테스트/시뮬레이션 추가
