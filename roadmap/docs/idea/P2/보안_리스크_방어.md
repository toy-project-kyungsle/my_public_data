> **프론트가 커머스 핵심 플로우(결제/쿠폰/장바구니/로그인)에서 실제 사고를 막는 설계/코드/정책 액션 — OWASP Top 10의 접근통제/설정오류/취약 컴포넌트/인젝션(XSS 포함) 축을 기준으로**

(우선순위 근거는 OWASP Top 10의 **접근통제/설정오류/취약 컴포넌트/인젝션(XSS 포함)** 축이 실제 사고와 잘 맞아. ([owasp.org][1]))

---

## 0) 먼저 "리스크 표면"을 6개로 쪼개고 오너를 정한다

### 액션

- (1) 사용자 입력/콘텐츠 렌더(리뷰/상품설명/이벤트 HTML)
- (2) 인증/세션/토큰
- (3) 딥링크(Universal/App Links)
- (4) WebView(도메인 이동, postMessage)
- (5) 서드파티 스크립트/SDK(마케팅/결제/분석)
- (6) 의존성/공급망(NPM/Gradle/Pods)

✅ Done: "어디가 위험하고, 누가 책임지고, 차단 스위치(킬 스위치)는 뭐다"가 1페이지로 정리됨.

---

## 1) 웹: XSS/CSP는 "Strict CSP + 주입면 제거"로 간다

### 액션

**1-A. CSP를 '운영 가능한 방식'으로 단계 적용**

- CSP를 **Report-Only → Enforce** 순서로 가져가고, 위반을 리포트로 수집한다. ([MDN 웹 문서][2])
- 가능하면 `script-src`는 **nonce/hash 기반(=Strict CSP)** 중심으로 설계한다. MDN은 nonce/hash 기반 CSP와 `strict-dynamic` 키워드를 설명한다. ([MDN 웹 문서][2])

✅ Done: "결제/로그인/체크아웃" 페이지에서 `unsafe-inline` 제거(또는 최소화) + Report-Only 위반률이 관리 가능한 수준.

**1-B. DOM XSS를 구조적으로 막기: Trusted Types 도입 후보**

`innerHTML` 같은 "주입 싱크(sink)"를 원천 차단하는 방식. ([Chrome for Developers][3])

- 위험 구간(상품설명 HTML, 이벤트 HTML, 후기 HTML 등)만 **격리 컴포넌트**로 두고, 나머지는 텍스트 렌더 원칙.
- Trusted Types를 켜서 "검증되지 않은 문자열이 DOM 주입으로 못 들어가게" 방어(가능한 브라우저부터). ([MDN 웹 문서][4])

✅ Done: `dangerouslySetInnerHTML`/`.innerHTML` 사용 지점이 "한 곳(또는 극소수)"로 줄고, 그곳에만 sanitizer/정책이 붙어있음.

**1-C. 클릭재킹/설정오류 같이 잡기(웹 보안은 설정에서 많이 터짐)**

- CSP의 `frame-ancestors`(또는 X-Frame-Options)로 결제/로그인 화면이 iframe으로 뜨는 위험을 차단(피싱/클릭재킹 방어).
- "불필요한 기능/과도한 정보 노출" 같은 설정 오류는 OWASP에서도 큰 축이다. ([owasp.org][5])

✅ Done: 체크아웃/로그인 페이지가 외부 프레이밍 불가 + 민감 에러/스택 노출 없음.

---

## 2) 앱(RN): 토큰/딥링크/WebView는 "하이재킹 방지"가 핵심

### 액션

**2-A. 토큰/민감정보 저장/누출 방지(모바일 표준 프레임)**

OWASP MASVS는 모바일 보안 표준이고, 특히 STORAGE가 "민감정보 안전 저장/누출 방지"를 다룬다. ([OWASP 모바일 애플리케이션 보안][6])

- 토큰/세션키는 **보안 저장소(Keychain/Keystore 계열)** 사용(평문 저장 금지).
- 로그/크래시 리포트에 토큰/PII가 찍히지 않도록 **마스킹 룰** 고정.

✅ Done: 앱에서 토큰이 "디스크 평문"에 남지 않고, 로그/리포트 샘플에서도 노출이 없음.

**2-B. 딥링크는 "검증 링크(Verified Links)"로 통일**

- Android: **App Links 검증(assetlinks.json)**이 공식 경로. ([Android Developers][7])
- iOS: **Associated Domains + apple-app-site-association(AASA)**가 공식 경로. ([Apple Developer][8])

- 결제/쿠폰/로그인으로 바로 가는 딥링크는:
  - host/path **allowlist**
  - 민감 액션은 **서버 재확인(로그인 상태/세션/주문 상태)** 필수
- "외부 앱이 링크를 가로채는" 하이재킹 리스크를 줄이기 위해 검증 링크 중심으로 정리.

✅ Done: 커스텀 스킴 남발이 줄고, https 기반 Verified/Universal Links가 기본 경로가 됨.

**2-C. WebView는 "도메인 이동과 메시지"를 통제해야 한다**

OWASP MASTG는 WebView에서 URL 로딩 통제(예: `shouldOverrideUrlLoading`)를 테스트 포인트로 다룬다. ([OWASP 모바일 애플리케이션 보안][9])

- WebView navigation을 **allowlist**(내 도메인/신뢰 도메인만)로 제한하고, 외부 이동은 시스템 브라우저로.
- `postMessage`/브릿지 통신은:
  - origin 검증
  - 메시지 스키마 검증("명령 문자열 실행" 금지)

✅ Done: WebView에서 "외부 도메인으로의 무단 이동/리다이렉트"가 원천 차단되거나 사용자 확인이 강제됨.

---

## 3) 서드파티 스크립트/SDK: "공급망 + 킬스위치"가 실전 방어

OWASP Top 10은 **취약/구식 컴포넌트(A06)**와 **설정오류(A05)**를 큰 위험으로 본다. ([owasp.org][10])

### 액션

- 신규 SDK/태그 도입 시 프론트 체크리스트("도입 심사")를 고정:
  - 수집 데이터(PII 여부), 전송 도메인, 권한, 업데이트 주기, 장애 시 영향, 제거/비활성화 방법
- **킬 스위치(원격 비활성화)**를 준비:
  마케팅 태그/SDK는 문제 생기면 "끄는 것"이 가장 빠른 완화책.

✅ Done: 결제/로그인 플로우에 영향을 줄 수 있는 서드파티는 모두 "끄는 방법"이 문서/코드로 확보됨.

---

## 4) "프론트 코드 레벨"에서 보안 회귀를 막는 규칙(가장 가성비 좋음)

### 액션

**4-A. 금지 API/패턴을 린트/리뷰 규칙으로 박기**

- 금지(또는 리뷰 필수) 리스트:
  - `dangerouslySetInnerHTML`, `.innerHTML`, `eval/new Function`
  - WebView에서 allowlist 없는 URL 로딩
  - 딥링크 파라미터를 검증 없이 라우팅/액션 실행
- PR 템플릿에 "보안 영향" 섹션 추가(결제/쿠폰/로그인/장바구니 변경이면 필수)

✅ Done: 위험 API 사용이 "자동 감지"되고, 예외는 사유/대안이 PR에 남음.

---

## 5) 커머스 핵심 플로우별 "프론트가 특히 막아야 하는 사고" 한 줄씩

### 액션

- **로그인**: 세션/토큰 탈취 → 계정 구매/개인정보 유출 (토큰 저장/로그 마스킹/딥링크 검증)
- **쿠폰**: 파라미터 조작/중복 적용/상태 꼬임 → 할인 오적용 (서버 권위 + 클라 재시도/중복요청 통제)
- **장바구니**: merge/수량 레이스 → 금액/재고 꼬임 (동시 요청/중복 클릭 통제)
- **결제**: 리다이렉트/웹뷰 하이재킹/중복 시도 → 결제 실패/중복 결제 (딥링크/WebView 통제 + 멱등 전제)

(접근통제/인증 실패는 Top 10에서도 핵심 축) ([owasp.org][1])

✅ Done: 플로우별 핵심 방어 포인트가 한 줄씩 정리됨.

---

[1]: https://owasp.org/Top10/2021/A01_2021-Broken_Access_Control/?utm_source=chatgpt.com "A01 Broken Access Control - OWASP Top 10:2021"
[2]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP?utm_source=chatgpt.com "Content Security Policy (CSP) - HTTP - MDN Web Docs"
[3]: https://developer.chrome.com/docs/lighthouse/best-practices/trusted-types-xss?utm_source=chatgpt.com "Mitigate DOM-based XSS with Trusted Types | Lighthouse"
[4]: https://developer.mozilla.org/en-US/docs/Web/API/Trusted_Types_API?utm_source=chatgpt.com "Trusted Types API - MDN Web Docs"
[5]: https://owasp.org/Top10/2021/A05_2021-Security_Misconfiguration/?utm_source=chatgpt.com "A05 Security Misconfiguration - OWASP Top 10:2021"
[6]: https://mas.owasp.org/MASVS/?utm_source=chatgpt.com "OWASP MASVS"
[7]: https://developer.android.com/training/app-links/verify-applinks?utm_source=chatgpt.com "Verify App Links | App architecture"
[8]: https://developer.apple.com/documentation/xcode/supporting-associated-domains?utm_source=chatgpt.com "Supporting associated domains"
[9]: https://mas.owasp.org/MASTG-TEST-0027/?utm_source=chatgpt.com "MASTG-TEST-0027: Testing for URL Loading in WebViews"
[10]: https://owasp.org/Top10/2021/A06_2021-Vulnerable_and_Outdated_Components/?utm_source=chatgpt.com "A06:2021 – Vulnerable and Outdated Components ..."
