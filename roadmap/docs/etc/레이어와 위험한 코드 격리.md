고위험 코드를 격리하는 것은 단순히 "코드를 예쁘게 정리하는 것" 이상의 의미가 있습니다. 이는 **"장애가 발생했을 때 범인을 찾는 시간을 줄이고, 수정 시 엉뚱한 곳이 터지는 연쇄 반응(Side Effect)을 물리적으로 차단하는 것"**이 핵심입니다.

제시해주신 레이어 구조와 격리 전략을 구체적으로 어떻게 운영하면 좋을지, 그 '실전 전술'을 정리해 드립니다.

---

## 1. 레이어별 역할과 "금기 사항" (Constraints)

각 레이어는 서로 엄격한 경계가 있어야 합니다. 특히 **도메인(Domain) 레이어의 순수성**이 무너지면 격리 전략은 실패합니다.

| 레이어 | 주요 역할 | **절대 하지 말아야 할 것 (Constraints)** |
| --- | --- | --- |
| **Domain** | 비즈니스 규칙 (예: 할인율 계산, 상태 전이 조건) | UI 라이브러리 참조(React/Vue 등), API 호출, 로컬 스토리지 접근 |
| **Services** | 외부 데이터 통신 (API), 데이터 가공, 캐싱 전략 | 복잡한 비즈니스 로직 포함 (계산 등), 직접적인 UI 상태 조작 |
| **UI (View)** | 데이터 출력, 사용자 인터페이스 이벤트 수집 | 비즈니스 로직 계산 (예: `if (price > 10000) ...`), 데이터 원본 수정 |

> **💡 핵심 팁:** `domain/` 폴더 안의 코드는 **프레임워크 없이도 실행 가능(Unit Testable)**해야 합니다. 만약 결제 로직을 테스트하는 데 브라우저나 서버가 필요하다면, 격리에 실패한 것입니다.

---

## 2. "위험한 코드" 전용 게이트웨이 (Sinks)

WebView 브릿지나 `dangerouslySetInnerHTML`, 직접적인 DOM 조작 같은 고위험 API는 프로젝트 전역에서 발견되면 안 됩니다. 이를 **"싱크(Sink)"**라고 부르는 특정 모듈에만 모아두어야 합니다.

### 적용 방법

* **Bridge 통일:** `window.postMessage`를 직접 호출하지 않고, `NativeBridgeService.js` 하나만 거치게 합니다.
* **보안 래퍼(Wrapper):** 외부 HTML을 렌더링해야 한다면 `SafeHtml.tsx` 같은 컴포넌트 하나만 만들고, 다른 곳에서 `dangerouslySetInnerHTML`을 사용하는 것을 **ESLint 설정(no-restricted-syntax)**으로 막아버립니다.

---

## 3. 격리를 통한 "리뷰 밀도" 극대화

모든 코드를 꼼꼼히 리뷰하는 것은 현실적으로 어렵습니다. 하지만 구조가 격리되어 있다면 **리뷰어의 에너지를 전략적으로 배분**할 수 있습니다.

* **UI 변경 PR:** "픽셀이 맞는지, 디자인 가이드를 준수했는지" 가볍게 확인.
* **Domain/Services 변경 PR:** **"비상벨 발령"**. 이 파일이 수정되었다면 모든 메인 유지보수자가 모여서 불변식(P0 기준)이 깨지지 않았는지 멱등성, 에러 핸들링 등을 현미경 수준으로 검토합니다.

---

## 4. 격리가 주는 테스트의 이점

격리가 잘 된 구조에서는 테스트 코드의 가성비가 수직 상승합니다.

1. **도메인 테스트 (High Value):** UI 없이 비즈니스 로직만 테스트하므로 속도가 매우 빠르고 안정적입니다. (예: "쿠폰 5개 적용 시 최대 할인액 초과 여부" 등)
2. **Mocking의 단순화:** `services/` 레이어만 모킹(Mocking)하면 UI 테스트를 쉽게 진행할 수 있습니다. API 응답이 이상하게 올 때 UI가 어떻게 반응하는지(Fallback)를 아주 쉽게 재현할 수 있죠.

---

> **"구조는 곧 지도입니다."**
> 고위험 코드가 격리되어 있으면, 신규 입사자나 협업자가 "어디를 건드리면 위험한지"를 지도를 보듯 직관적으로 알 수 있습니다. 사고는 보통 "여기가 위험한 줄 모르고" 건드렸을 때 발생하니까요.

### 다음 단계로 추천하는 액션

혹시 현재 프로젝트에서 **가장 많이 스파게티처럼 꼬여있는(UI와 로직이 섞인) 구체적인 사례**가 하나 있을까요? 그 코드를 어떻게 `domain/service/ui`로 쪼개볼 수 있을지 예시를 만들어 드릴 수 있습니다.